define ("core_calendar/view_manager",["jquery","core/templates","core/str","core/notification","core_calendar/repository","core_calendar/events","core_calendar/selectors","core/modal_factory","core/modal_events","core_calendar/summary_modal","core/custom_interaction_events","core/pending"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(b){b=a(b);b.on("click",g.links.eventLink,function(b){var c=new l("core_calendar/view_manager:eventLink:click"),d=a(b.target),e=null,f;if(d.is(g.actions.viewEvent)){f=d}else{f=d.closest(g.actions.viewEvent)}if(f.length){e=f.data("eventId")}else{e=d.find(g.actions.viewEvent).data("eventId")}if(e){b.preventDefault();b.stopPropagation();v(e).then(c.resolve()).catch()}else{c.resolve()}});b.on("click",g.links.navLink,function(c){var d=b.find(g.wrapper),e=d.data("view"),f=d.data("courseid"),h=d.data("categoryid"),i=a(c.currentTarget);if("month"===e){o(b,i.attr("href"),i.data("year"),i.data("month"),f,h,i.data("day"));c.preventDefault()}else if("day"===e){q(b,i.attr("href"),i.data("year"),i.data("month"),i.data("day"),f,h);c.preventDefault()}});var c=b.find(g.viewSelector);k.define(c,[k.events.activate]);c.on(k.events.activate,function(c){c.preventDefault();var e=a(c.target);if(e.hasClass("active")){return}var f=e.data("view"),g=e.data("year"),h=e.data("month"),i=e.data("day"),j=e.data("courseid"),k=e.data("categoryid");if("month"==f){n(b,g,h,j,k,b,"core_calendar/calendar_month",i).then(function(){return window.history.pushState({},"","?view=month")}).fail(d.exception)}else if("day"==f){p(b,g,h,i,j,k,b,"core_calendar/calendar_day").then(function(){return window.history.pushState({},"","?view=day")}).fail(d.exception)}else if("upcoming"==f){t(b,j,k,b,"core_calendar/calendar_upcoming").then(function(){return window.history.pushState({},"","?view=upcoming")}).fail(d.exception)}})},n=function(c,h,i,j,k,l,m,n){r(c);l=l||c.find(g.wrapper);m=m||c.attr("data-template");n=n||1;M.util.js_pending([c.get("id"),h,i,j].join("-"));var o=c.data("includenavigation"),p=c.data("mini");return e.getCalendarMonthData(h,i,j,k,o,p,n).then(function(a){a.viewingmonth=!0;return b.render(m,a)}).then(function(a,c){return b.replaceNode(l,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){M.util.js_complete([c.get("id"),h,i,j].join("-"));return s(c)}).fail(d.exception)},o=function(b,c,d,e,g,h,i){i=i||1;return n(b,d,e,g,h,null,null,i).then(function(){if(c.length&&"#"!==c){window.history.pushState({},"",c)}return arguments}).then(function(){a("body").trigger(f.monthChanged,[d,e,g,h]);return arguments})},p=function(c,h,i,j,k,l,m,n){r(c);m=m||c.find(g.wrapper);n=n||c.attr("data-template");M.util.js_pending([c.get("id"),h,i,j,k,l].join("-"));var o=c.data("includenavigation");return e.getCalendarDayData(h,i,j,k,l,o).then(function(a){a.viewingday=!0;return b.render(n,a)}).then(function(a,c){return b.replaceNode(m,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){M.util.js_complete([c.get("id"),h,i,j,k,l].join("-"));return s(c)}).fail(d.exception)},q=function(b,c,d,e,g,h,i){return p(b,d,e,g,h,i).then(function(){if(c.length&&"#"!==c){window.history.pushState({},"",c)}return arguments}).then(function(){a("body").trigger(f.dayChanged,[d,e,h,i]);return arguments})},r=function(a){var b=a.find(g.containers.loadingIcon);b.removeClass("hidden")},s=function(a){var b=a.find(g.containers.loadingIcon);b.addClass("hidden")},t=function(c,h,i,j,k){r(c);j=j||c.find(g.wrapper);k=k||c.attr("data-template");if("undefined"==typeof h){h=c.find(g.wrapper).data("courseid")}if("undefined"==typeof i){i=c.find(g.wrapper).data("categoryid")}return e.getCalendarUpcomingData(h,i).then(function(a){a.viewingupcoming=!0;return b.render(k,a)}).then(function(a,c){return b.replaceNode(j,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return s(c)}).fail(d.exception)},u=function(a){return"calendar_event_"+a},v=function(a){var c=new l("core_calendar/view_manager:renderEventSummaryModal"),f="";return e.getEventById(a).then(function(b){if(!b.event){throw new Error("Error encountered while trying to fetch calendar event with ID: "+a)}var c=b.event;f=u(c.normalisedeventtype);return c}).then(function(a){var c={title:a.name,type:j.TYPE,body:b.render("core_calendar/event_summary_body",a),templateContext:{canedit:a.canedit,candelete:a.candelete,headerclasses:f,isactionevent:a.isactionevent,url:a.url}};return h.create(c)}).then(function(a){a.getRoot().on(i.hidden,function(){a.destroy()});a.show();return a}).then(function(a){c.resolve();return a}).catch(d.exception)};return{init:function init(a,b){m(a,b)},reloadCurrentMonth:function reloadCurrentMonth(a,b,c){var d=a.find(g.wrapper).data("year"),e=a.find(g.wrapper).data("month"),f=a.find(g.wrapper).data("day");if("undefined"==typeof b){b=a.find(g.wrapper).data("courseid")}if("undefined"==typeof c){c=a.find(g.wrapper).data("categoryid")}return n(a,d,e,b,c,null,null,f)},changeMonth:o,refreshMonthContent:n,reloadCurrentDay:function reloadCurrentDay(a,b,c){var d=a.find(g.wrapper),e=d.data("year"),f=d.data("month"),h=d.data("day");if(!b){b=a.find(g.wrapper).data("courseid")}if("undefined"==typeof c){c=a.find(g.wrapper).data("categoryid")}return p(a,e,f,h,b,c)},changeDay:q,refreshDayContent:p,reloadCurrentUpcoming:t}});
//# sourceMappingURL=view_manager.min.js.map
