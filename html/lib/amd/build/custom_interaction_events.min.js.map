{"version":3,"file":"custom_interaction_events.min.js","sources":["../src/custom_interaction_events.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module provides a wrapper to encapsulate a lot of the common combinations of\n * user interaction we use in Moodle.\n *\n * @module     core/custom_interaction_events\n * @copyright  2016 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.2\n */\ndefine(['jquery', 'core/key_codes'], function($, keyCodes) {\n    // The list of events provided by this module. Namespaced to avoid clashes.\n    var events = {\n        activate: 'cie:activate',\n        keyboardActivate: 'cie:keyboardactivate',\n        escape: 'cie:escape',\n        down: 'cie:down',\n        up: 'cie:up',\n        home: 'cie:home',\n        end: 'cie:end',\n        next: 'cie:next',\n        previous: 'cie:previous',\n        asterix: 'cie:asterix',\n        scrollLock: 'cie:scrollLock',\n        scrollTop: 'cie:scrollTop',\n        scrollBottom: 'cie:scrollBottom',\n        ctrlPageUp: 'cie:ctrlPageUp',\n        ctrlPageDown: 'cie:ctrlPageDown',\n        enter: 'cie:enter',\n        accessibleChange: 'cie:accessibleChange',\n    };\n    // Static cache of jQuery events that have been handled. This should\n    // only be populated by JavaScript generated events (which will keep it\n    // fairly small).\n    var triggeredEvents = {};\n\n    /**\n     * Check if the caller has asked for the given event type to be\n     * registered.\n     *\n     * @method shouldAddEvent\n     * @private\n     * @param {string} eventType name of the event (see events above)\n     * @param {array} include the list of events to be added\n     * @return {bool} true if the event should be added, false otherwise.\n     */\n    var shouldAddEvent = function(eventType, include) {\n        include = include || [];\n\n        if (include.length && include.indexOf(eventType) !== -1) {\n            return true;\n        }\n\n        return false;\n    };\n\n    /**\n     * Check if any of the modifier keys have been pressed on the event.\n     *\n     * @method isModifierPressed\n     * @private\n     * @param {event} e jQuery event\n     * @return {bool} true if shift, meta (command on Mac), alt or ctrl are pressed\n     */\n    var isModifierPressed = function(e) {\n        return (e.shiftKey || e.metaKey || e.altKey || e.ctrlKey);\n    };\n\n    /**\n     * Trigger the custom event for the given jQuery event.\n     *\n     * This function will only fire the custom event if one hasn't already been\n     * fired for the jQuery event.\n     *\n     * This is to prevent multiple custom event handlers triggering multiple\n     * custom events for a single jQuery event as it bubbles up the stack.\n     *\n     * @param  {string} eventName The name of the custom event\n     * @param  {event} e          The jQuery event\n     * @return {void}\n     */\n    var triggerEvent = function(eventName, e) {\n        var eventTypeKey = \"\";\n\n        if (!e.hasOwnProperty('originalEvent')) {\n            // This is a jQuery event generated from JavaScript not a browser event so\n            // we need to build the cache key for the event.\n            eventTypeKey = \"\" + eventName + e.type + e.timeStamp;\n\n            if (!triggeredEvents.hasOwnProperty(eventTypeKey)) {\n                // If we haven't seen this jQuery event before then fire a custom\n                // event for it and remember the event for later.\n                triggeredEvents[eventTypeKey] = true;\n                $(e.target).trigger(eventName, [{originalEvent: e}]);\n            }\n            return;\n        }\n\n        eventTypeKey = \"triggeredCustom_\" + eventName;\n        if (!e.originalEvent.hasOwnProperty(eventTypeKey)) {\n            // If this is a jQuery event generated by the browser then set a\n            // property on the original event to track that we've seen it before.\n            // The property is set on the original event because it's the only part\n            // of the jQuery event that is maintained through multiple event handlers.\n            e.originalEvent[eventTypeKey] = true;\n            $(e.target).trigger(eventName, [{originalEvent: e}]);\n            return;\n        }\n    };\n\n    /**\n     * Register a keyboard event that ignores modifier keys.\n     *\n     * @method addKeyboardEvent\n     * @private\n     * @param {object} element A jQuery object of the element to bind events to\n     * @param {string} event The custom interaction event name\n     * @param {int} keyCode The key code.\n     */\n    var addKeyboardEvent = function(element, event, keyCode) {\n        element.off('keydown.' + event).on('keydown.' + event, function(e) {\n            if (!isModifierPressed(e)) {\n                if (e.keyCode == keyCode) {\n                    triggerEvent(event, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the activate event on the given element if it is clicked or the enter\n     * or space key are pressed without a modifier key.\n     *\n     * @method addActivateListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addActivateListener = function(element) {\n        element.off('click.cie.activate').on('click.cie.activate', function(e) {\n            triggerEvent(events.activate, e);\n        });\n        element.off('keydown.cie.activate').on('keydown.cie.activate', function(e) {\n            if (!isModifierPressed(e)) {\n                if (e.keyCode == keyCodes.enter || e.keyCode == keyCodes.space) {\n                    triggerEvent(events.activate, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the keyboard activate event on the given element if the enter\n     * or space key are pressed without a modifier key.\n     *\n     * @method addKeyboardActivateListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addKeyboardActivateListener = function(element) {\n        element.off('keydown.cie.keyboardactivate').on('keydown.cie.keyboardactivate', function(e) {\n            if (!isModifierPressed(e)) {\n                if (e.keyCode == keyCodes.enter || e.keyCode == keyCodes.space) {\n                    triggerEvent(events.keyboardActivate, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the escape event on the given element if the escape key is pressed\n     * without a modifier key.\n     *\n     * @method addEscapeListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addEscapeListener = function(element) {\n        addKeyboardEvent(element, events.escape, keyCodes.escape);\n    };\n\n    /**\n     * Trigger the down event on the given element if the down arrow key is pressed\n     * without a modifier key.\n     *\n     * @method addDownListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addDownListener = function(element) {\n        addKeyboardEvent(element, events.down, keyCodes.arrowDown);\n    };\n\n    /**\n     * Trigger the up event on the given element if the up arrow key is pressed\n     * without a modifier key.\n     *\n     * @method addUpListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addUpListener = function(element) {\n        addKeyboardEvent(element, events.up, keyCodes.arrowUp);\n    };\n\n    /**\n     * Trigger the home event on the given element if the home key is pressed\n     * without a modifier key.\n     *\n     * @method addHomeListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addHomeListener = function(element) {\n        addKeyboardEvent(element, events.home, keyCodes.home);\n    };\n\n    /**\n     * Trigger the end event on the given element if the end key is pressed\n     * without a modifier key.\n     *\n     * @method addEndListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addEndListener = function(element) {\n        addKeyboardEvent(element, events.end, keyCodes.end);\n    };\n\n    /**\n     * Trigger the next event on the given element if the right arrow key is pressed\n     * without a modifier key in LTR mode or left arrow key in RTL mode.\n     *\n     * @method addNextListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addNextListener = function(element) {\n        // Left and right are flipped in RTL mode.\n        var keyCode = $('html').attr('dir') == \"rtl\" ? keyCodes.arrowLeft : keyCodes.arrowRight;\n\n        addKeyboardEvent(element, events.next, keyCode);\n    };\n\n    /**\n     * Trigger the previous event on the given element if the left arrow key is pressed\n     * without a modifier key in LTR mode or right arrow key in RTL mode.\n     *\n     * @method addPreviousListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addPreviousListener = function(element) {\n        // Left and right are flipped in RTL mode.\n        var keyCode = $('html').attr('dir') == \"rtl\" ? keyCodes.arrowRight : keyCodes.arrowLeft;\n\n        addKeyboardEvent(element, events.previous, keyCode);\n    };\n\n    /**\n     * Trigger the asterix event on the given element if the asterix key is pressed\n     * without a modifier key.\n     *\n     * @method addAsterixListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addAsterixListener = function(element) {\n        addKeyboardEvent(element, events.asterix, keyCodes.asterix);\n    };\n\n\n    /**\n     * Trigger the scrollTop event on the given element if the user scrolls to\n     * the top of the given element.\n     *\n     * @method addScrollTopListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addScrollTopListener = function(element) {\n        element.off('scroll.cie.scrollTop').on('scroll.cie.scrollTop', function(e) {\n            var scrollTop = element.scrollTop();\n            if (scrollTop === 0) {\n                triggerEvent(events.scrollTop, e);\n            }\n        });\n    };\n\n    /**\n     * Trigger the scrollBottom event on the given element if the user scrolls to\n     * the bottom of the given element.\n     *\n     * @method addScrollBottomListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addScrollBottomListener = function(element) {\n        element.off('scroll.cie.scrollBottom').on('scroll.cie.scrollBottom', function(e) {\n            var scrollTop = element.scrollTop();\n            var innerHeight = element.innerHeight();\n            var scrollHeight = element[0].scrollHeight;\n\n            if (scrollTop + innerHeight >= scrollHeight) {\n                triggerEvent(events.scrollBottom, e);\n            }\n        });\n    };\n\n    /**\n     * Trigger the scrollLock event on the given element if the user scrolls to\n     * the bottom or top of the given element.\n     *\n     * @method addScrollLockListener\n     * @private\n     * @param {jQuery} element jQuery object to add event listeners to\n     */\n    var addScrollLockListener = function(element) {\n        // Lock mousewheel scrolling within the element to stop the annoying window scroll.\n        element.off('DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock')\n            .on('DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock', function(e) {\n                var scrollTop = element.scrollTop();\n                var scrollHeight = element[0].scrollHeight;\n                var height = element.height();\n                var delta = (e.type == 'DOMMouseScroll' ?\n                    e.originalEvent.detail * -40 :\n                    e.originalEvent.wheelDelta);\n                var up = delta > 0;\n\n                if (!up && -delta > scrollHeight - height - scrollTop) {\n                    // Scrolling down past the bottom.\n                    element.scrollTop(scrollHeight);\n                    e.stopPropagation();\n                    e.preventDefault();\n                    e.returnValue = false;\n                    // Fire the scroll lock event.\n                    triggerEvent(events.scrollLock, e);\n\n                    return false;\n                } else if (up && delta > scrollTop) {\n                    // Scrolling up past the top.\n                    element.scrollTop(0);\n                    e.stopPropagation();\n                    e.preventDefault();\n                    e.returnValue = false;\n                    // Fire the scroll lock event.\n                    triggerEvent(events.scrollLock, e);\n\n                    return false;\n                }\n\n                return true;\n            });\n    };\n\n    /**\n     * Trigger the ctrlPageUp event on the given element if the user presses the\n     * control and page up key.\n     *\n     * @method addCtrlPageUpListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addCtrlPageUpListener = function(element) {\n        element.off('keydown.cie.ctrlpageup').on('keydown.cie.ctrlpageup', function(e) {\n            if (e.ctrlKey) {\n                if (e.keyCode == keyCodes.pageUp) {\n                    triggerEvent(events.ctrlPageUp, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the ctrlPageDown event on the given element if the user presses the\n     * control and page down key.\n     *\n     * @method addCtrlPageDownListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addCtrlPageDownListener = function(element) {\n        element.off('keydown.cie.ctrlpagedown').on('keydown.cie.ctrlpagedown', function(e) {\n            if (e.ctrlKey) {\n                if (e.keyCode == keyCodes.pageDown) {\n                    triggerEvent(events.ctrlPageDown, e);\n                }\n            }\n        });\n    };\n\n    /**\n     * Trigger the enter event on the given element if the enter key is pressed\n     * without a modifier key.\n     *\n     * @method addEnterListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addEnterListener = function(element) {\n        addKeyboardEvent(element, events.enter, keyCodes.enter);\n    };\n\n    /**\n     * Trigger the AccessibleChange event on the given element if the value of the element is changed.\n     *\n     * @method addAccessibleChangeListener\n     * @private\n     * @param {object} element jQuery object to add event listeners to\n     */\n    var addAccessibleChangeListener = function(element) {\n        var onMac = navigator.userAgent.indexOf('Macintosh') !== -1;\n        var touchEnabled = ('ontouchstart' in window) || (('msMaxTouchPoints' in navigator) && (navigator.msMaxTouchPoints > 0));\n        if (onMac || touchEnabled) {\n            // On Mac devices, and touch-enabled devices, the change event seems to be handled correctly and\n            // consistently at this time.\n            element.on('change', function(e) {\n                triggerEvent(events.accessibleChange, e);\n            });\n        } else {\n            // Some browsers have non-normalised behaviour for handling the selection of values in a <select> element.\n            // When using Chrome on Linux (and possibly others), a 'change' event is fired when pressing the Escape key.\n            // When using Firefox on Linux (and possibly others), a 'change' event is fired when navigating through the\n            // list with a keyboard.\n            //\n            // To normalise these behaviours:\n            // - the initial value is stored in a data attribute when focusing the element\n            // - the current value is checked against the stored initial value when and the accessibleChange event fired when:\n            // --- blurring the element\n            // --- the 'Enter' key is pressed\n            // --- the element is clicked\n            // --- the 'change' event is fired, except where it is from a keyboard interaction\n            //\n            // To facilitate the change event keyboard interaction check, the 'keyDown' handler sets a flag to ignore\n            // the change event handler which is unset on the 'keyUp' event.\n            //\n            // Unfortunately we cannot control this entirely as some browsers (Chrome) trigger a change event when\n            // pressign the Escape key, and this is considered to be the correct behaviour.\n            // Chrome https://bugs.chromium.org/p/chromium/issues/detail?id=839717\n            //\n            // Our longer-term solution to this should be to switch away from using <select> boxes as a single-select,\n            // and make use of a dropdown of action links like the Bootstrap Dropdown menu.\n            var setInitialValue = function(target) {\n                target.dataset.initValue = target.value;\n            };\n            var resetToInitialValue = function(target) {\n                if ('initValue' in target.dataset) {\n                    target.value = target.dataset.initValue;\n                }\n            };\n            var checkAndTriggerAccessibleChange = function(e) {\n                if (!('initValue' in e.target.dataset)) {\n                    // Some browsers trigger click before focus, therefore it is possible that initValue is undefined.\n                    // In this case it's likely that it's being focused for the first time and we should therefore not submit.\n                    return;\n                }\n\n                if (e.target.value !== e.target.dataset.initValue) {\n                    // Update the initValue when the event is triggered.\n                    // This means that if the click handler fires before the focus handler on a subsequent interaction\n                    // with the element, the currently dispalyed value will be the best guess current value.\n                    e.target.dataset.initValue = e.target.value;\n                    triggerEvent(events.accessibleChange, e);\n                }\n            };\n            var nativeElement = element.get()[0];\n            // The `focus` and `blur` events do not support bubbling. Use Event Capture instead.\n            nativeElement.addEventListener('focus', function(e) {\n                setInitialValue(e.target);\n            }, true);\n            nativeElement.addEventListener('blur', function(e) {\n                checkAndTriggerAccessibleChange(e);\n            }, true);\n            element.on('keydown', function(e) {\n                if ((e.which === keyCodes.enter)) {\n                    checkAndTriggerAccessibleChange(e);\n                } else if (e.which === keyCodes.escape) {\n                    resetToInitialValue(e.target);\n                    e.target.dataset.ignoreChange = true;\n                } else {\n                    // Firefox triggers a change event when using the keyboard to scroll through the selection.\n                    // Set a data- attribute that the change listener can use to ignore the change event where it was\n                    // generated from a keyboard change such as typing to complete a value, or using arrow keys.\n                    e.target.dataset.ignoreChange = true;\n\n                }\n            });\n            element.on('change', function(e) {\n                if (e.target.dataset.ignoreChange) {\n                    // This change event was triggered from a keyboard change which is not yet complete.\n                    // Do not trigger the accessibleChange event until the selection is completed using the [return]\n                    // key.\n                    return;\n                }\n\n                checkAndTriggerAccessibleChange(e);\n            });\n            element.on('keyup', function(e) {\n                // The key has been lifted. Stop ignoring the change event.\n                delete e.target.dataset.ignoreChange;\n            });\n            element.on('click', function(e) {\n                checkAndTriggerAccessibleChange(e);\n            });\n        }\n    };\n\n    /**\n     * Get the list of events and their handlers.\n     *\n     * @method getHandlers\n     * @private\n     * @return {object} object key of event names and value of handler functions\n     */\n    var getHandlers = function() {\n        var handlers = {};\n\n        handlers[events.activate] = addActivateListener;\n        handlers[events.keyboardActivate] = addKeyboardActivateListener;\n        handlers[events.escape] = addEscapeListener;\n        handlers[events.down] = addDownListener;\n        handlers[events.up] = addUpListener;\n        handlers[events.home] = addHomeListener;\n        handlers[events.end] = addEndListener;\n        handlers[events.next] = addNextListener;\n        handlers[events.previous] = addPreviousListener;\n        handlers[events.asterix] = addAsterixListener;\n        handlers[events.scrollLock] = addScrollLockListener;\n        handlers[events.scrollTop] = addScrollTopListener;\n        handlers[events.scrollBottom] = addScrollBottomListener;\n        handlers[events.ctrlPageUp] = addCtrlPageUpListener;\n        handlers[events.ctrlPageDown] = addCtrlPageDownListener;\n        handlers[events.enter] = addEnterListener;\n        handlers[events.accessibleChange] = addAccessibleChangeListener;\n\n        return handlers;\n    };\n\n    /**\n     * Add all of the listeners on the given element for the requested events.\n     *\n     * @method define\n     * @public\n     * @param {object} element the DOM element to register event listeners on\n     * @param {array} include the array of events to be triggered\n     */\n    var define = function(element, include) {\n        element = $(element);\n        include = include || [];\n\n        if (!element.length || !include.length) {\n            return;\n        }\n\n        $.each(getHandlers(), function(eventType, handler) {\n            if (shouldAddEvent(eventType, include)) {\n                handler(element);\n            }\n        });\n    };\n\n    return {\n        define: define,\n        events: events,\n    };\n});\n"],"names":["define","$","keyCodes","events","activate","keyboardActivate","escape","down","up","home","end","next","previous","asterix","scrollLock","scrollTop","scrollBottom","ctrlPageUp","ctrlPageDown","enter","accessibleChange","triggeredEvents","isModifierPressed","e","shiftKey","metaKey","altKey","ctrlKey","triggerEvent","eventName","eventTypeKey","hasOwnProperty","originalEvent","target","trigger","type","timeStamp","addKeyboardEvent","element","event","keyCode","off","on","addActivateListener","space","addKeyboardActivateListener","addEscapeListener","addDownListener","arrowDown","addUpListener","arrowUp","addHomeListener","addEndListener","addNextListener","attr","arrowLeft","arrowRight","addPreviousListener","addAsterixListener","addScrollTopListener","addScrollBottomListener","innerHeight","scrollHeight","addScrollLockListener","height","delta","detail","wheelDelta","stopPropagation","preventDefault","returnValue","addCtrlPageUpListener","pageUp","addCtrlPageDownListener","pageDown","addEnterListener","addAccessibleChangeListener","onMac","navigator","userAgent","indexOf","touchEnabled","window","msMaxTouchPoints","checkAndTriggerAccessibleChange","dataset","value","initValue","nativeElement","get","addEventListener","which","ignoreChange","include","handlers","length","each","eventType","handler","shouldAddEvent"],"mappings":"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"}