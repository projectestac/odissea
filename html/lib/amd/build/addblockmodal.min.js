define("core/addblockmodal",["exports","core/modal_factory","core/templates","core/str","core/ajax"],(function(_exports,_modal_factory,_templates,_str,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax);var _ref,_ref2,SELECTORS_ADD_BLOCK='[data-key="addblock"]',addBlockModal=null,registerListenerEvents=function(pageType,pageLayout,addBlockUrl,subPage){document.addEventListener("click",(function(e){e.target.closest(SELECTORS_ADD_BLOCK)&&(e.preventDefault(),addBlockModal?addBlockModal.show():buildAddBlockModal().then((function(modal){addBlockModal=modal;var modalBody=renderBlocks(addBlockUrl,pageType,pageLayout,subPage);return modal.setBody(modalBody),modal.show(),modalBody})).catch((function(){addBlockModal.destroy(),addBlockModal=null})))}))},buildAddBlockModal=function(){return _modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:(0,_str.get_string)("addblock")})},renderBlocks=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(addBlockUrl,pageType,pageLayout,subPage){var blocks;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,getAddableBlocks(pageType,pageLayout,subPage);case 2:return blocks=_context.sent,_context.abrupt("return",_templates.default.render("core/add_block_body",{blocks:blocks,url:addBlockUrl}));case 4:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3,_x4){return _ref.apply(this,arguments)}),getAddableBlocks=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(pageType,pageLayout,subPage){var request;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return request={methodname:"core_block_fetch_addable_blocks",args:{pagecontextid:M.cfg.contextid,pagetype:pageType,pagelayout:pageLayout,subpage:subPage}},_context2.abrupt("return",_ajax.default.call([request])[0]);case 2:case"end":return _context2.stop()}}),_callee2)}))),function(_x5,_x6,_x7){return _ref2.apply(this,arguments)});_exports.init=function(pageType,pageLayout,addBlockUrl){var subPage=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";registerListenerEvents(pageType,pageLayout,addBlockUrl,subPage)}}));

//# sourceMappingURL=addblockmodal.min.js.map