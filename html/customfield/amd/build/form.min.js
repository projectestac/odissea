define ("core_customfield/form",["exports","core/inplace_editable","core/ajax","core/str","core_form/modalform","core/notification","core/pending","core/sortable_list","core/templates","jquery"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;e=k(e);f=k(f);g=k(g);h=k(h);i=k(i);j=k(j);function k(a){return a&&a.__esModule?a:{default:a}}var l=function(a,b,e,h,k){var l=new g.default("core_customfield/form:confirmDelete");(0,d.get_strings)([{key:"confirm"},{key:"confirmdelete"+b,component:"core_customfield"},{key:"yes"},{key:"no"}]).then(function(d){return f.default.confirm(d[0],d[1],d[2],d[3],function(){var d=new g.default("core_customfield/form:confirmDelete");(0,c.call)([{methodname:"field"===b?"core_customfield_delete_field":"core_customfield_delete_category",args:{id:a}},{methodname:"core_customfield_reload_template",args:{component:e,area:h,itemid:k}}])[1].then(function(a){return i.default.render("core_customfield/list",a)}).then(function(a,b){return i.default.replaceNode((0,j.default)("[data-region=\"list-page\"]"),a,b)}).then(d.resolve).catch(f.default.exception)})}).then(l.resolve).catch(f.default.exception)},m=function(a,b,d){var e=new g.default("core_customfield/form:createNewCategory"),h=(0,c.call)([{methodname:"core_customfield_create_category",args:{component:a,area:b,itemid:d}},{methodname:"core_customfield_reload_template",args:{component:a,area:b,itemid:d}}]);h[1].then(function(a){return i.default.render("core_customfield/list",a)}).then(function(a,b){return i.default.replaceNode((0,j.default)("[data-region=\"list-page\"]"),a,b)}).then(function(){return e.resolve()}).catch(f.default.exception)},n=function(a,b,f,h){var k=new g.default("core_customfield/form:createNewField"),l=a.closest(".action-menu").querySelector(".dropdown-toggle"),m=new e.default({formClass:"core_customfield\\field_config_form",args:{categoryid:a.getAttribute("data-categoryid"),type:a.getAttribute("data-type")},modalConfig:{title:(0,d.get_string)("addingnewcustomfield","core_customfield",a.getAttribute("data-typename"))},returnFocus:l});m.addEventListener(m.events.FORM_SUBMITTED,function(){var a=new g.default("core_customfield/form:createdNewField"),d=(0,c.call)([{methodname:"core_customfield_reload_template",args:{component:b,area:f,itemid:h}}]);d[0].then(function(a){return i.default.render("core_customfield/list",a)}).then(function(a,b){return i.default.replaceNode((0,j.default)("[data-region=\"list-page\"]"),a,b)}).then(function(){return a.resolve()}).catch(function(){return window.location.reload()})});m.show();k.resolve()},o=function(a,b,f,h){var k=new g.default("core_customfield/form:editField"),l=new e.default({formClass:"core_customfield\\field_config_form",args:{id:a.getAttribute("data-id")},modalConfig:{title:(0,d.get_string)("editingfield","core_customfield",a.getAttribute("data-name"))},returnFocus:a});l.addEventListener(l.events.FORM_SUBMITTED,function(){var a=new g.default("core_customfield/form:createdNewField"),d=(0,c.call)([{methodname:"core_customfield_reload_template",args:{component:b,area:f,itemid:h}}]);d[0].then(function(a){return i.default.render("core_customfield/list",a)}).then(function(a,b){return i.default.replaceNode((0,j.default)("[data-region=\"list-page\"]"),a,b)}).then(function(){return a.resolve()}).catch(function(){return window.location.reload()})});l.show();k.resolve()},p=function(a){return a.closest("[data-category-id]").find("[data-inplaceeditable][data-itemtype=category][data-component=core_customfield]").attr("data-value")},q=function(a){var b=new h.default("#customfield_catlist .categorieslist",{moveHandlerSelector:".movecategory [data-drag-type=move]"});b.getElementName=function(a){return Promise.resolve(p(a))};(0,j.default)("[data-category-id]").on(h.default.EVENTS.DROP,function(a,b){if(b.positionChanged){var d=new g.default("core_customfield/form:categoryid:on:sortablelist-drop");(0,c.call)([{methodname:"core_customfield_move_category",args:{id:b.element.data("category-id"),beforeid:b.targetNextElement.data("category-id")}}])[0].then(d.resolve).catch(f.default.exception)}a.stopPropagation()});var e=new h.default("#customfield_catlist .fieldslist tbody",{moveHandlerSelector:".movefield [data-drag-type=move]"});e.getDestinationName=function(a,b){if(!b.length){return(0,d.get_string)("totopofcategory","customfield",p(a))}else if(b.attr("data-field-name")){return(0,d.get_string)("afterfield","customfield",b.attr("data-field-name"))}else{return Promise.resolve("")}};(0,j.default)("[data-field-name]").on(h.default.EVENTS.DROP,function(a,b){if(b.positionChanged){var d=new g.default("core_customfield/form:fieldname:on:sortablelist-drop");(0,c.call)([{methodname:"core_customfield_move_field",args:{id:b.element.data("field-id"),beforeid:b.targetNextElement.data("field-id"),categoryid:+b.targetList.closest("[data-category-id]").attr("data-category-id")}}])[0].then(d.resolve).catch(f.default.exception)}a.stopPropagation()});(0,j.default)("[data-field-name]").on(h.default.EVENTS.DRAG,function(b){var c=new g.default("core_customfield/form:fieldname:on:sortablelist-drag");b.stopPropagation();i.default.render("core_customfield/nofields",{}).then(function(b){a.querySelectorAll(".categorieslist > *").forEach(function(a){var c=a.querySelectorAll(".field:not(.sortable-list-is-dragged)"),d=a.querySelector(".nofields");if(!c.length&&!d){a.querySelector("tbody").innerHTML=b}else if(c.length&&d){d.remove()}})}).then(c.resolve).catch(f.default.exception)});(0,j.default)("[data-category-id], [data-field-name]").on(h.default.EVENTS.DRAGSTART,function(a,b){setTimeout(function(){(0,j.default)(".sortable-list-is-dragged").width(b.element.width())},501)})};a.init=function init(){var a=document.querySelector("#customfield_catlist"),b=a.dataset.component,c=a.dataset.area,d=a.dataset.itemid;a.addEventListener("click",function(a){var e=a.target.closest("[data-role]");if(!e){return}if("deletefield"===e.dataset.role){a.preventDefault();l(e.dataset.id,"field",b,c,d);return}if("deletecategory"===e.dataset.role){a.preventDefault();l(e.dataset.id,"category",b,c,d);return}if("addnewcategory"===e.dataset.role){a.preventDefault();m(b,c,d);return}if("addfield"===e.dataset.role){a.preventDefault();n(e,b,c,d);return}if("editfield"===e.dataset.role){a.preventDefault();o(e,b,c,d)}});q(a,b,c,d)}});
//# sourceMappingURL=form.min.js.map
