/**
 * Javascript Module to help set up user needs browser storage.
 *
 * @module format_tiles/browser_storage_set_up
 * @copyright 2019 David Watson {@link http://evolutioncode.uk}
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since Moodle 3.3
 */
define("format_tiles/browser_storage_set_up",["jquery"],(function($){var userId,storageUserConsent_GIVEN="yes",storageUserConsent_DENIED="no",localStorageKeyElements_userPrefStorage="mdl-tiles-userPrefStorage",localStorageKeyElements_user="-user-",storageType_local="local",storageType_session="session",Enabled={local:!1,session:!1},userChoice=null,encodeStorageKey=function(){return localStorageKeyElements_userPrefStorage+localStorageKeyElements_user+userId},storageAllowed=function(){if(null!==userChoice)return userChoice;var browserChoice=localStorage.getItem(encodeStorageKey());return browserChoice?userChoice=browserChoice===storageUserConsent_GIVEN:null},setAllowed=function(allowedOrNot){allowedOrNot?(userChoice=!0,localStorage.setItem(encodeStorageKey(),storageUserConsent_GIVEN)):(userChoice=!1,localStorage.setItem(encodeStorageKey(),storageUserConsent_DENIED))},obtainUserPreference=function(){require(["core/str","core/notification"],(function(str,Notification){str.get_strings([{key:"datapref",component:"format_tiles"},{key:"dataprefquestion",component:"format_tiles"},{key:"yes"},{key:"cancel",component:"moodle"}]).done((function(s){Notification.confirm(s[0],s[1],s[2],s[3],(function(){setAllowed(!0)}),(function(){setAllowed(!1)}))}))}))},storageInitialCheck=function(localOrSession){var storage;try{return localOrSession===storageType_local?storage=localStorage:localOrSession===storageType_session&&(storage=sessionStorage),void 0===storage?!1:(storage.setItem("testItem","testValue"),"testValue"===storage.getItem("testItem")&&(storage.removeItem("testItem"),!0))}catch(err){return require(["core/log"],(function(log){log.debug(err)})),!1}};return{setAllowed:function(allowedOrNot){setAllowed(allowedOrNot)},storageAllowed:function(){return storageAllowed()},getStorageKey:function(){return encodeStorageKey()},Enabled:Enabled,init:function(userIdInit,assumeConsent){userId=userIdInit,$(document).ready((function(){Enabled.local=storageInitialCheck(storageType_local),Enabled.session=storageInitialCheck(storageType_session),assumeConsent?userChoice=!0:null===storageAllowed()&&Enabled.local&&setTimeout((function(){obtainUserPreference()}),3e3),$('a[href*="datapref"]').click((function(e){e.preventDefault(),obtainUserPreference()}))}))}}}));

//# sourceMappingURL=browser_storage_set_up.min.js.map