function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_accessreview/module",["exports","core/ajax","core/templates","core/notification"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=f(c);function e(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;e=function(){return a};return a}function f(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=e();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a){if(Object.prototype.hasOwnProperty.call(a,f)){var g=d?Object.getOwnPropertyDescriptor(a,f):null;if(g&&(g.get||g.set)){Object.defineProperty(c,f,g)}else{c[f]=a[f]}}}c.default=a;if(b){b.set(a,c)}return c}function g(a,b){return m(a)||l(a,b)||j(a,b)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(a,b){if(!a)return;if("string"==typeof a)return k(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return k(a,b)}function k(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function l(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function m(a){if(Array.isArray(a))return a}var n=!0,o=function(a,b,d,e,f,g){var h=parseInt((b-f)/g*2),i={resultPassed:!b,classList:"",passRate:{errorCount:b,checkCount:d,failureRate:Math.round(100*(b/d))}};if(!a){return Promise.resolve()}var j=["block_accessreview"];if(i.resultPassed){j.push("block_accessreview_success")}else if(h){j.push("block_accessreview_danger")}else{j.push("block_accessreview_warning")}var k="showicons"==e||"showboth"==e,l="showbackground"==e||"showboth"==e;if(l&&!k){var m;(m=a.classList).add.apply(m,j.concat(["alert"]));return Promise.resolve()}if(k&&!l){i.classList=j.join(" ")}return c.renderForPromise("block_accessreview/status",i).then(function(b){var d=b.html,e=b.js;c.appendNodeContents(a,d,e);if(l){var f;(f=a.classList).add.apply(f,j.concat(["alert"]))}}).catch()},p=function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1;return Promise.all(w(a,c)).then(function(a){var c,d,e=g(a,2),f=e[0],h=e[1],i=s(f,h),j=i.minViews,k=i.viewDelta;f.forEach(function(a){var c=document.querySelector("#section-".concat(a.section," .summary"));if(!c){return}o(c,a.numerrors,a.numchecks,b,j,k)});h.forEach(function(a){var c=document.getElementById("module-".concat(a.cmid));if(!c){return}o(c,a.numerrors,a.numchecks,b,j,k)});(c=document.querySelector(".icon-accessmap").classList).remove.apply(c,["fa-eye-slash"]);(d=document.querySelector(".icon-accessmap").classList).add.apply(d,["fa-eye"]);return{sectionData:f,moduleData:h}}).catch(d.exception)},q=function(){var a,b,c=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!1;document.querySelectorAll(".block_accessreview_view").forEach(function(a){return a.remove()});var d=["block_accessreview","block_accessreview_success","block_accessreview_warning","block_accessreview_danger","block_accessreview_view","alert"];document.querySelectorAll(".block_accessreview").forEach(function(a){var b;return(b=a.classList).remove.apply(b,d)});if(c){v(!1)}(a=document.querySelector(".icon-accessmap").classList).remove.apply(a,["fa-eye"]);(b=document.querySelector(".icon-accessmap").classList).add.apply(b,["fa-eye-slash"])},r=function(a,b){n=!n;if(!n){q(!0)}else{p(a,b,!0)}},s=function(a,b){var c={totalErrors:0,totalUsers:0,minViews:0,maxViews:0,viewDelta:0};[].concat(a,b).forEach(function(a){c.totalErrors+=a.numerrors;if(a.numerrors<c.minViews){c.minViews=a.numerrors}if(a.numerrors>c.maxViews){c.maxViews=a.numerrors}c.totalUsers+=a.numchecks});c.viewDelta=c.maxViews-c.minViews+1;return c},t=function(a,b){document.addEventListener("click",function(c){if(c.target.closest("#toggle-accessmap")){c.preventDefault();r(a,b)}})},u=function(a){return{methodname:"core_user_update_user_preferences",args:{preferences:[{type:"block_accessreviewtogglestate",value:a}]}}},v=function(a){return(0,b.call)([u(a)])},w=function(a){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,d=[{methodname:"block_accessreview_get_section_data",args:{courseid:a}},{methodname:"block_accessreview_get_module_data",args:{courseid:a}}];if(c){d.push(u(!0))}return(0,b.call)(d)},x=function(a,b,c){n=1==a;if(n){p(c,b)}t(c,b)};a.init=x});
//# sourceMappingURL=module.min.js.map
